// Erstelle professionelles HTML-Angebot mit editierbaren Feldern
    <div class="recipient">
        <strong>${firmenname}</strong>
        ${ansprechpartner ? ansprechpartner + '<br>' : ''}
        ${strasse ? strasse + '<br>' : ''}
        ${plz || ort ? (plz + ' ' + ort).trim() : ''}
    </div>

    <div class="meta-info">
        <div><strong>Angebotsnummer:</strong> ${angebotsnr}</div>
        <div><strong>Datum:</strong> ${datumStr}</div>
        <div><strong>G√ºltig bis:</strong> ${new Date(heute.getTime() + 30*24*60*60*1000).toLocaleDateString('de-DE')}</div>
        <div><strong>Ihr Jahresumsatz:</strong> ${umsatz.toLocaleString('de-DE')} ‚Ç¨</div>
    </div>

    <h1>Individuelles Angebot f√ºr Buchhaltungsdienstleistungen</h1>

    <div class="intro">
        <div contenteditable="true">
            <p><strong>Sehr geehrte Damen und Herren${ansprechpartner ? ', sehr geehrte/r ' + ansprechpartner : ''},</strong></p>
            <p>vielen Dank f√ºr Ihr Interesse an unseren Dienstleistungen. Basierend auf den von Ihnen bereitgestellten Informationen zu Ihrer Unternehmensstruktur erstellen wir Ihnen gerne folgendes individuelles Angebot:</p>
            <p><em style="color: #3b82f6; font-size: 0.9em;">üí° Tipp: Dieser Text ist editierbar - klicken Sie hinein um ihn anzupassen und auf Besonderheiten einzugehen!</em></p>
        </div>
    </div>

    <div class="bewertung">
        <h2>üìä Die Zusammensetzung Ihres Berechnungspreises</h2>
        
        <div class="explanation-box">
            <strong>üí° So funktioniert unsere Preisberechnung:</strong><br>
            Wir bewerten Ihr Unternehmen anhand verschiedener Kriterien. <strong>Je niedriger Ihre Punktzahl, desto besser!</strong><br>
            Weniger Punkte bedeuten einen niedrigeren Zehntel-Satz und damit g√ºnstigere Konditionen f√ºr Sie.
        </div>
        
        <div class="kriterien-grid">
            <div class="kriterien-header">Kriterium</div>
            <div class="kriterien-header">Status</div>
            <div class="kriterien-header">Punkte</div>
            
            <div class="kriterien-row"><strong>Zulieferung vor Stichtag</strong></div>
            <div class="kriterien-row">${state.zulieferung === 'ja' ? '<span class="status-badge status-green">Immer rechtzeitig</span>' : state.zulieferung === 'meistens' ? '<span class="status-badge status-yellow">Meistens</span>' : '<span class="status-badge status-red">Oft versp√§tet</span>'}</div>
            <div class="kriterien-row">${state.zulieferung === 'ja' ? '0' : state.zulieferung === 'meistens' ? '1' : '2'} Pkt</div>
            
            <div class="kriterien-row"><strong>Belegformat</strong></div>
            <div class="kriterien-row">${state.belegFormat === 'perfekt' ? '<span class="status-badge status-green">1:1 PDF</span>' : state.belegFormat === 'stapel' ? '<span class="status-badge status-yellow">Stapel</span>' : '<span class="status-badge status-red">Scan/Foto</span>'}</div>
            <div class="kriterien-row">${state.belegFormat === 'perfekt' ? '0' : state.belegFormat === 'stapel' ? '0.5' : '2'} Pkt</div>
            
            <div class="kriterien-row"><strong>Bankkonten</strong></div>
            <div class="kriterien-row">${state.bankkonten === 'eins' ? '<span class="status-badge status-green">1 Konto</span>' : state.bankkonten === 'mehrere_mit' ? '<span class="status-badge status-yellow">>1 mit API</span>' : '<span class="status-badge status-red">>1 ohne API</span>'}</div>
            <div class="kriterien-row">${state.bankkonten === 'eins' ? '0' : state.bankkonten === 'mehrere_mit' ? '1' : '1.5'} Pkt</div>
            
            <div class="kriterien-row"><strong>Auslandsgesch√§ft</strong></div>
            <div class="kriterien-row">${state.ausland === 'null' ? '<span class="status-badge status-green">0%</span>' : state.ausland === 'unter10' ? '<span class="status-badge status-yellow"><10%</span>' : '<span class="status-badge status-red">>10%</span>'}</div>
            <div class="kriterien-row">${state.ausland === 'null' ? '0' : state.ausland === 'unter10' ? '1' : '1.5'} Pkt</div>
            
            <div class="kriterien-row"><strong>Bankums√§tze</strong></div>
            <div class="kriterien-row">${state.bankumsaetze === 'schnittstelle' ? '<span class="status-badge status-green">API</span>' : state.bankumsaetze === 'csv' ? '<span class="status-badge status-yellow">CSV</span>' : '<span class="status-badge status-red">PDF</span>'}</div>
            <div class="kriterien-row">${state.bankumsaetze === 'schnittstelle' ? '0' : state.bankumsaetze === 'csv' ? '0.5' : '2'} Pkt</div>
            
            <div class="kriterien-row"><strong>Belegzusendung</strong></div>
            <div class="kriterien-row">${state.belege === 'schnittstelle' ? '<span class="status-badge status-green">API</span>' : state.belege === 'dragdrop' ? '<span class="status-badge status-yellow">Upload</span>' : '<span class="status-badge status-red">Post/Email</span>'}</div>
            <div class="kriterien-row">${state.belege === 'schnittstelle' ? '0' : state.belege === 'dragdrop' ? '0.5' : '1'} Pkt</div>
        </div>

        <div class="zehntel-box">
            <div class="label">Ihr individueller Zehntel-Satz</div>
            <div class="value">${satz}/10</div>
            <div style="margin-top: 10px; color: #666;">
                <strong>Gesamtpunkte: ${punkte.toFixed(1)} von 10 Punkten</strong><br>
                <small>Je niedriger die Punktzahl, desto g√ºnstiger der Preis</small>
            </div>
        </div>
    </div>

    <div class="preise">
        <h2>üí∞ Ihre monatlichen Kosten</h2>
        
        <div class="price-overview">
            <div class="preis-table">
                <table>
                    <thead>
                        <tr>
                            <th>Leistung</th>
                            <th>Details</th>
                            <th style="text-align: right;">Preis (netto)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Finanzbuchhaltung</strong></td>
                            <td>
                                Vollumf√§ngliche Buchhaltung f√ºr Jahresumsatz ${umsatz.toLocaleString('de-DE')} ‚Ç¨<br>
                                <small style="color: #666;">Inkl. Umsatzsteuervoranmeldung, BWA, Kontenabstimmung</small>
                            </td>
                            <td style="text-align: right; font-weight: 600;">${fibu.toFixed(2)} ‚Ç¨</td>
                        </tr>
                        ${state.mitLohn && state.mitarbeiterAnzahl ? `
                        <tr>
                            <td><strong>Lohnbuchhaltung</strong></td>
                            <td>
                                ${state.mitarbeiterAnzahl} Mitarbeiter √ó ${lohnProMA.toFixed(2)} ‚Ç¨<br>
                                <small style="color: #666;">Inkl. Lohnabrechnungen, Meldungen, Bescheinigungen</small>
                            </td>
                            <td style="text-align: right; font-weight: 600;">${lohn.toFixed(2)} ‚Ç¨</td>
                        </tr>
                        ` : ''}
                        <tr class="total-row">
                            <td colspan="2"><strong>Gesamtsumme (netto) pro Monat</strong></td>
                            <td style="text-align: right;" class="highlight-preis">${gesamt.toFixed(2)} ‚Ç¨</td>
                        </tr>
                        <tr>
                            <td colspan="2">zzgl. 19% MwSt.</td>
                            <td style="text-align: right;">${(gesamt * 0.19).toFixed(2)} ‚Ç¨</td>
                        </tr>
                        <tr class="total-row">
                            <td colspan="2"><strong>Gesamtsumme (brutto) pro Monat</strong></td>
                            <td style="text-align: right;" class="highlight-preis">${mitMwst.toFixed(2)} ‚Ç¨</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            ${state.mitLohn && state.mitarbeiterAnzahl ? `
            <div class="pie-chart-container">
                <canvas id="pieChart" width="200" height="200"></canvas>
                <p style="margin-top: 10px; font-size: 0.9em; color: #666;">Kostenaufteilung</p>
            </div>
            ` : ''}
        </div>
    </div>

    <div class="footer">
        <strong>Leistungsumfang:</strong>
        <div contenteditable="true" style="border: 1px dashed #ccc; padding: 10px; border-radius: 5px; background: #f9fafb;">
            <ul>
                <li>Erfassung aller Gesch√§ftsvorf√§lle in moderner Buchhaltungssoftware</li>
                <li>Monatliche Erstellung von BWA (Betriebswirtschaftliche Auswertung)</li>
                <li>Umsatzsteuer-Voranmeldungen an das Finanzamt</li>
                <li>Jahresabschlussvorbereitung (E√úR) f√ºr Ihren Steuerberater</li>
                ${state.mitLohn && state.mitarbeiterAnzahl ? '<li>Vollst√§ndige Lohnbuchhaltung inkl. aller Meldungen und Bescheinigungen</li>' : ''}
                <li>Pers√∂nlicher Ansprechpartner f√ºr alle Fragen</li>
                <li>Digitale Dokumentenverwaltung</li>
                <li>Tagesaktuelle BWA-Auswertungen</li>
                <li>Automatische Bankanbindung</li>
            </ul>
            <p style="color: #3b82f6; font-size: 0.85em; margin-top: 10px;"><em>üí° Dieser Bereich ist editierbar - Sie k√∂nnen Leistungen hinzuf√ºgen oder entfernen</em></p>
        </div>

        <strong style="margin-top: 30px;">Konditionen:</strong>
        <div contenteditable="true" style="border: 1px dashed #ccc; padding: 10px; border-radius: 5px; background: #f9fafb;">
            <ul>
                <li><strong>Vertragslaufzeit:</strong> Unbefristet</li>
                <li><strong>K√ºndigungsfrist:</strong> 4 Wochen zum Monatsende</li>
                <li><strong>Zahlung:</strong> Monatlich im Voraus per SEPA-Lastschrift</li>
                <li><strong>Angebot g√ºltig:</strong> 30 Tage ab Ausstellungsdatum</li>
                <li><strong>Unterlagen-Frist:</strong> Bis zum 5. Werktag des Folgemonats f√ºr p√ºnktliche UStVA</li>
                <li><strong>Plattform-Zugang:</strong> Inklusive (BWA, Belege, Steuerr√ºcklagen)</li>
                <li><strong>Support:</strong> Per E-Mail, WhatsApp und Plattform-Chat</li>
            </ul>
            <p style="color: #3b82f6; font-size: 0.85em; margin-top: 10px;"><em>üí° Dieser Bereich ist editierbar - Sie k√∂nnen Konditionen anpassen</em></p>
        </div>

        <p style="margin-top: 20px;">Bei Fragen oder f√ºr ein pers√∂nliches Gespr√§ch stehen wir Ihnen gerne zur Verf√ºgung. Wir freuen uns auf eine erfolgreiche Zusammenarbeit!</p>
    </div>

    <div class="agb-notice">
        <strong>‚ö†Ô∏è Wichtiger Hinweis zu den Gesch√§ftsbedingungen</strong>
        <p style="margin-top: 10px;">
            Mit Unterzeichnung dieses Angebots stimmen Sie unseren 
            <a href="https://bilancor.de/agb" target="_blank">Allgemeinen Gesch√§ftsbedingungen (AGB)</a> sowie dem 
            <a href="https://bilancor.de/avv" target="_blank">Auftragsverarbeitungsvertrag (AVV)</a> zu.
        </p>
        <p style="margin-top: 10px; font-size: 0.9em;">
            Bitte lesen Sie diese Dokumente aufmerksam durch. Bei Fragen stehen wir Ihnen gerne zur Verf√ºgung.
        </p>
    </div>

    <div class="unterschriften">
        <div class="unterschrift">
            <div style="font-weight: bold; margin-bottom: 10px;">F√ºr Bilancor GmbH:</div>
            <div class="unterschrift-line"></div>
            <div style="margin-top: 10px;">
                <strong>Carsten Lebtig</strong><br>
                <small style="color: #666;">Gesch√§ftsf√ºhrer</small>
            </div>
            <div class="unterschrift-info">
                <div>
                    <label>Ort:</label>
                    <div contenteditable="true" style="border-bottom: 1px solid #333; min-width: 150px; padding: 5px;">Berlin</div>
                </div>
                <div>
                    <label>Datum:</label>
                    <div contenteditable="true" style="border-bottom: 1px solid #333; min-width: 150px; padding: 5px;">${datumStr}</div>
                </div>
            </div>
        </div>

        <div class="unterschrift">
            <div style="font-weight: bold; margin-bottom: 10px;">F√ºr ${firmenname}:</div>
            <div class="unterschrift-line"></div>
            <div style="margin-top: 10px;">
                <div contenteditable="true" style="min-height: 24px; border-bottom: 1px dashed #ccc; padding: 5px; margin-bottom: 5px;">
                    <strong>${ansprechpartner || '[Name]'}</strong>
                </div>
                <small style="color: #666;">Unterschrift & Name</small>
            </div>
            <div class="unterschrift-info">
                <div>
                    <label>Ort:</label>
                    <div contenteditable="true" style="border-bottom: 1px solid #333; min-width: 150px; padding: 5px;">${ort || '[Ort]'}</div>
                </div>
                <div>
                    <label>Datum:</label>
                    <div contenteditable="true" style="border-bottom: 1px solid #333; min-width: 150px; padding: 5px;">[Datum]</div>
                </div>
            </div>
        </div>
    </div>

    ${state.mitLohn && state.mitarbeiterAnzahl ? `
    <script>
        // Kuchendiagramm erstellen
        const canvas = document.getElementById('pieChart');
        const ctx = canvas.getContext('2d');
        const fibuAnteil = ${fibu};
        const lohnAnteil = ${lohn};
        const total = fibuAnteil + lohnAnteil;
        
        const fibuProzent = (fibuAnteil / total) * 100;
        const lohnProzent = (lohnAnteil / total) * 100;
        
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = 80;
        
        // Finanzbuchhaltung (Blau)
        ctx.beginPath();
        ctx.fillStyle = '#1e3a8a';
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, 0, (fibuAnteil / total) * 2 * Math.PI);
        ctx.closePath();
        ctx.fill();
        
        // Lohnbuchhaltung (Orange)
        ctx.beginPath();
        ctx.fillStyle = '#fb923c';
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, (fibuAnteil / total) * 2 * Math.PI, 2 * Math.PI);
        ctx.closePath();
        ctx.fill();
        
        // Legende
        ctx.font = '12px sans-serif';
        ctx.fillStyle = '#1e3a8a';
        ctx.fillRect(20, canvas.height - 40, 15, 15);
        ctx.fillStyle = '#333';
        ctx.fillText('Fibu: ' + fibuProzent.toFixed(0) + '%', 40, canvas.height - 28);
        
        ctx.fillStyle = '#fb923c';
        ctx.fillRect(20, canvas.height - 20, 15, 15);
        ctx.fillStyle = '#333';
        ctx.fillText('Lohn: ' + lohnProzent.toFixed(0) + '%', 40, canvas.height - 8);
    </script>
    ` : ''}
</body>
</html>`;

            // √ñffne Angebot in neuem Fenster
            const printWindow = window.open('', '_blank', 'width=900,height=1200');
            
            if (!printWindow || printWindow.closed || typeof printWindow.closed === 'undefined') {
                alert('‚ö†Ô∏è Popup-Blocker aktiv!\n\nBitte erlauben Sie Popups f√ºr diese Seite und versuchen Sie es erneut.');
            } else {
                printWindow.document.write(angebotHTML);
                printWindow.document.close();
            }
        });>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Angebot - ${firmenname}</title>
    <style>
        @media print {
            body { margin: 0; }
            @page { margin: 1.5cm; }
            .no-print { display: none !important; }
            [contenteditable] { border: none !important; background: transparent !important; }
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 210mm;
            margin: 0 auto;
            padding: 20mm;
            background: white;
        }
        [contenteditable] {
            border: 1px dashed #ccc;
            padding: 2px 4px;
            border-radius: 3px;
            min-height: 20px;
        }
        [contenteditable]:hover {
            background: #f0f9ff;
            border-color: #3b82f6;
        }
        [contenteditable]:focus {
            outline: 2px solid #3b82f6;
            background: white;
        }
        .edit-hint {
            color: #3b82f6;
            font-size: 0.75em;
            font-style: italic;
            margin-left: 5px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #1e3a8a;
        }
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .company-info {
            text-align: right;
            font-size: 0.9em;
            color: #666;
        }
        .company-info strong {
            color: #1e3a8a;
            font-size: 1.2em;
            display: block;
            margin-bottom: 5px;
        }
        .recipient {
            margin: 30px 0;
        }
        .recipient strong {
            display: block;
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        .meta-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 30px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .meta-info div {
            font-size: 0.9em;
        }
        .meta-info strong {
            color: #1e3a8a;
        }
        h1 {
            color: #1e3a8a;
            font-size: 1.8em;
            margin: 30px 0 20px 0;
        }
        h2 {
            color: #1e3a8a;
            font-size: 1.3em;
            margin: 20px 0 15px 0;
        }
        .intro {
            margin: 20px 0;
            line-height: 1.8;
            background: #f0f9ff;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }
        .bewertung {
            background: #eff6ff;
            padding: 20px;
            border-radius: 8px;
            margin: 30px 0;
            border-left: 4px solid #1e3a8a;
        }
        .explanation-box {
            background: #fef3c7;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #f59e0b;
            font-size: 0.95em;
        }
        .explanation-box strong {
            color: #92400e;
        }
        .kriterien-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        .kriterien-header {
            font-weight: bold;
            padding: 10px;
            background: #1e3a8a;
            color: white;
            border-radius: 5px 5px 0 0;
        }
        .kriterien-row {
            padding: 10px;
            background: white;
            border-bottom: 1px solid #e5e7eb;
        }
        .kriterien-row:last-child {
            border-bottom: none;
            border-radius: 0 0 5px 5px;
        }
        .zehntel-box {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            text-align: center;
            border: 2px solid #1e3a8a;
        }
        .zehntel-box .label {
            font-size: 0.9em;
            color: #666;
        }
        .zehntel-box .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #1e3a8a;
        }
        .preise {
            margin: 30px 0;
        }
        .price-overview {
            display: flex;
            gap: 30px;
            align-items: center;
            margin: 20px 0;
        }
        .preis-table {
            flex: 2;
        }
        .preis-table table {
            width: 100%;
            border-collapse: collapse;
        }
        .preis-table th {
            background: #1e3a8a;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        .preis-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        .preis-table tr:last-child td {
            border-bottom: none;
        }
        .preis-table .total-row {
            background: #f8f9fa;
            font-weight: bold;
            font-size: 1.1em;
        }
        .preis-table .total-row td {
            padding: 15px 12px;
            border-top: 2px solid #1e3a8a;
        }
        .highlight-preis {
            color: #1e3a8a;
            font-size: 1.2em;
        }
        .pie-chart-container {
            flex: 1;
            text-align: center;
        }
        .pie-chart-container canvas {
            max-width: 200px;
            max-height: 200px;
        }
        .footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
            font-size: 0.85em;
            color: #666;
        }
        .footer strong {
            display: block;
            margin-bottom: 10px;
            color: #1e3a8a;
            font-size: 1.1em;
        }
        .footer ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .footer li {
            margin: 5px 0;
        }
        .agb-notice {
            background: #fef3c7;
            padding: 20px;
            border-radius: 8px;
            margin: 30px 0;
            border-left: 4px solid #f59e0b;
        }
        .agb-notice strong {
            color: #92400e;
            font-size: 1.1em;
        }
        .agb-notice a {
            color: #1e3a8a;
            text-decoration: underline;
        }
        .unterschriften {
            margin-top: 60px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }
        .unterschrift {
            text-align: center;
        }
        .unterschrift-line {
            border-top: 2px solid #333;
            margin: 50px 0 10px 0;
        }
        .unterschrift-info {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 15px;
            font-size: 0.9em;
        }
        .unterschrift-info div {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .unterschrift-info label {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
        }
        .print-button {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            background: #1e3a8a;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        .print-button:hover {
            background: #1e40af;
        }
        .edit-mode-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #3b82f6;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: 600;
            z-index: 999;
        }
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
        .status-green { background: #d1fae5; color: #065f46; }
        .status-yellow { background: #fef3c7; color: #92400e; }
        .status-red { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>
    <div class="no-print edit-mode-banner">
        üìù BEARBEITUNGSMODUS - Klicken Sie auf die blauen Bereiche um Text zu bearbeiten
    </div>
    
    <button class="print-button no-print" onclick="window.print()">üñ®Ô∏è Drucken / Als PDF speichern</button>

    <div class="header">
        <div class="logo-section">
            <svg width="60" height="60" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="100" height="100" rx="15" fill="#1e3a8a"/>
                <circle cx="35" cy="35" r="20" fill="white"/>
                <circle cx="55" cy="55" r="15" fill="#fb923c"/>
            </svg>
            <div>
                <strong style="font-size: 1.5em; color: #1e3a8a;">Bilancor</strong>
                <div style="color: #666;">Buchhaltungsb√ºro f√ºr Selbst√§ndige & Unternehmer</div>
            </div>
        </div>
        <div class="company-info">
            <strong>Bilancor GmbH</strong>
            Richard-Ermisch-Str. 7<br>
            10247 Berlin<br>
            Tel: +49 15565509949<br>
            anfrage@bilancor.de<br>
            <small style="display: block; margin-top: 10px;">
            HRB 279439 B<br>
            Gesch√§ftsf√ºhrer: Carsten Lebtig
            </small>
        </div>
    </div>

    <div class="recipient">
        <strong>${firmenname}</strong>
        ${<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilancor Preisrechner</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f9fafb;
            padding: 1rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
            padding: 2rem;
            border-radius: 0.5rem 0.5rem 0 0;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo {
            background: white;
            padding: 0.5rem;
            border-radius: 0.5rem;
        }
        
        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }
        
        .header p {
            color: #bfdbfe;
            font-size: 0.875rem;
        }
        
        .alert {
            background-color: #fef2f2;
            border-left: 4px solid #ef4444;
            padding: 1rem;
            display: none;
            align-items: start;
            gap: 0.75rem;
        }
        
        .alert.show {
            display: flex;
        }
        
        .alert h3 {
            color: #991b1b;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }
        
        .alert p {
            color: #b91c1c;
            font-size: 0.875rem;
        }
        
        .content {
            background: white;
            padding: 1.5rem;
            border-radius: 0 0 0.5rem 0.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        @media (min-width: 768px) {
            .grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .section-title {
            font-size: 1.125rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .input-group {
            margin-bottom: 1rem;
        }
        
        .input-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #374151;
        }
        
        .input-group input[type="number"],
        .input-group input[type="text"] {
            width: 100%;
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
        }
        
        .checkbox-label input[type="checkbox"] {
            width: 1rem;
            height: 1rem;
            cursor: pointer;
        }
        
        .info-box {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
        }
        
        .info-box h3 {
            font-size: 0.875rem;
            font-weight: bold;
            margin-bottom: 0.75rem;
        }
        
        .info-score {
            padding-top: 0.5rem;
            border-top: 2px solid #9ca3af;
            margin-bottom: 0.5rem;
        }
        
        .score-display {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }
        
        .score-value {
            color: #2563eb;
        }
        
        .score-value.warning {
            color: #dc2626;
        }
        
        .score-note {
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .matching-table {
            padding-top: 0.5rem;
            margin-top: 0.5rem;
            border-top: 1px solid #d1d5db;
        }
        
        .matching-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            font-size: 0.75rem;
        }
        
        .matching-row {
            font-size: 0.75rem;
            color: #6b7280;
            padding: 0.125rem 0;
        }
        
        .matching-row.active {
            font-weight: bold;
        }
        
        .matching-row.green { color: #16a34a; }
        .matching-row.blue { color: #2563eb; }
        .matching-row.yellow { color: #ca8a04; }
        .matching-row.orange { color: #ea580c; }
        .matching-row.red { color: #dc2626; }
        
        .criteria-section {
            padding: 0.75rem;
            border-radius: 0.375rem;
            margin-bottom: 0.75rem;
        }
        
        .criteria-section h3 {
            font-size: 0.875rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .criteria-section.blue {
            background-color: #eff6ff;
            border: 1px solid #bfdbfe;
        }
        
        .criteria-section.orange {
            background-color: #fff7ed;
            border: 1px solid #fed7aa;
        }
        
        .criteria-section.purple {
            background-color: #faf5ff;
            border: 1px solid #e9d5ff;
        }
        
        .radio-group {
            margin-bottom: 0.75rem;
        }
        
        .radio-group-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 500;
            margin-bottom: 0.375rem;
        }
        
        .radio-buttons {
            display: flex;
            gap: 0.375rem;
        }
        
        .radio-btn {
            flex: 1;
            padding: 0.375rem 0.5rem;
            border: none;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            background-color: #f3f4f6;
            color: #6b7280;
            transition: all 0.2s;
        }
        
        .radio-btn:hover {
            background-color: #e5e7eb;
        }
        
        .radio-btn.active {
            color: white;
        }
        
        .radio-btn.active.green {
            background-color: #22c55e;
        }
        
        .radio-btn.active.yellow {
            background-color: #eab308;
        }
        
        .radio-btn.active.red {
            background-color: #dc2626;
        }
        
        .btn-label {
            font-weight: 600;
            display: block;
        }
        
        .btn-desc {
            font-size: 0.7rem;
            opacity: 0.75;
            margin-top: 0.125rem;
            line-height: 1.2;
        }
        
        .btn-points {
            font-size: 0.7rem;
            font-weight: bold;
            margin-top: 0.125rem;
        }
        
        .price-box {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
            border-radius: 0.5rem;
        }
        
        .price-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .price-item {
            text-align: center;
        }
        
        .price-label {
            color: #bfdbfe;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        
        .price-value {
            font-size: 1.875rem;
            font-weight: bold;
        }
        
        .price-value.highlight {
            color: #fb923c;
            font-size: 2.25rem;
        }
        
        .price-note {
            font-size: 0.75rem;
            color: #bfdbfe;
            margin-top: 0.25rem;
        }
        
        .price-footer {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #3b82f6;
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: #bfdbfe;
        }
        
        .angebot-section {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 0.5rem;
        }
        
        .angebot-section h3 {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #1e40af;
        }
        
        .kunde-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .kunde-grid-wide {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .angebot-btn {
            width: 100%;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .angebot-btn:hover {
            background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
        }
        
        .angebot-btn:active {
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            .kunde-grid,
            .kunde-grid-wide {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="logo">
                    <svg width="40" height="40" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="100" height="100" rx="15" fill="#1e3a8a"/>
                        <circle cx="35" cy="35" r="20" fill="white"/>
                        <circle cx="55" cy="55" r="15" fill="#fb923c"/>
                    </svg>
                </div>
                <div>
                    <h1>Bilancor Preisrechner</h1>
                    <p>Intelligente Preiskalkulation basierend auf Ihrer Unternehmensstruktur</p>
                </div>
            </div>
        </div>

        <div id="alert" class="alert">
            <div style="color: #ef4444; font-size: 1.5rem;">‚ö†Ô∏è</div>
            <div>
                <h3>Ausschlusskriterium erf√ºllt</h3>
                <p>Dieser Kunde erf√ºllt mindestens ein Ausschlusskriterium (KO-Kriterium). Eine Zusammenarbeit ist unter den aktuellen Bedingungen m√∂glicherweise nicht sinnvoll.</p>
            </div>
        </div>

        <div class="content">
            <div class="grid">
                <div>
                    <h2 class="section-title">üè¢ Kundendaten</h2>
                    
                    <div class="input-group">
                        <label for="jahresumsatz">Jahresumsatz (netto) in ‚Ç¨</label>
                        <input type="number" id="jahresumsatz" placeholder="z.B. 150000">
                    </div>

                    <div class="input-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="mitLohn" checked>
                            <span>Lohnbuchhaltung gew√ºnscht</span>
                        </label>
                    </div>

                    <div class="input-group" id="mitarbeiterGroup">
                        <label for="mitarbeiterAnzahl">üë• Anzahl Mitarbeiter</label>
                        <input type="number" id="mitarbeiterAnzahl" placeholder="z.B. 8">
                    </div>

                    <div class="info-box">
                        <h3>üìä Gesamtbewertung</h3>
                        <div class="info-score">
                            <div class="score-display">
                                <span>GESAMT:</span>
                                <span class="score-value" id="gesamtPunkte">0.0 / 10 Pkt</span>
                            </div>
                            <div class="score-note">Weniger Punkte = Besser! Maximum: 10 Punkte</div>
                        </div>
                        
                        <div class="matching-table">
                            <div class="matching-title">Matching-Tabelle:</div>
                            <div class="matching-row" data-range="0-0.5">0-0.5 Punkte ‚Üí 4/10 Satz</div>
                            <div class="matching-row" data-range="0.5-1.5">0.5-1.5 Punkte ‚Üí 5/10 Satz</div>
                            <div class="matching-row" data-range="1.5-3">1.5-3 Punkte ‚Üí 6/10 Satz</div>
                            <div class="matching-row" data-range="3-5">3-5 Punkte ‚Üí 7/10 Satz</div>
                            <div class="matching-row" data-range="5-7">5-7 Punkte ‚Üí 8/10 Satz</div>
                            <div class="matching-row" data-range="7-8.5">7-8.5 Punkte ‚Üí 9/10 Satz</div>
                            <div class="matching-row" data-range="8.5-10">8.5-10 Punkte ‚Üí 10/10 Satz</div>
                        </div>
                    </div>
                </div>

                <div>
                    <h2 class="section-title">üìã Bewertungskriterien</h2>

                    <div class="criteria-section blue">
                        <h3>üì¶ Zulieferung (max 4 Pkt)</h3>
                        
                        <div class="radio-group">
                            <label class="radio-group-label">Vollst√§ndige Zulieferung vor Stichtag (2 Pkt)</label>
                            <div class="radio-buttons">
                                <button class="radio-btn active green" data-group="zulieferung" data-value="ja" data-points="0">
                                    <div class="btn-label">Ja</div>
                                    <div class="btn-desc">Immer rechtzeitig</div>
                                    <div class="btn-points">0 Pkt</div>
                                </button>
                                <button class="radio-btn" data-group="zulieferung" data-value="meistens" data-points="1">
                                    <div class="btn-label">Meistens</div>
                                    <div class="btn-desc">√úberwiegend</div>
                                    <div class="btn-points">1 Pkt</div>
                                </button>
                                <button class="radio-btn" data-group="zulieferung" data-value="nein" data-points="2">
                                    <div class="btn-label">Nein</div>
                                    <div class="btn-desc">Oft versp√§tet</div>
                                    <div class="btn-points">2 Pkt</div>
                                </button>
                            </div>
                        </div>
                        
                        <div class="radio-group">
                            <label class="radio-group-label">100% eindeutig zugeordnet & digitalisiert (2 Pkt)</label>
                            <div class="radio-buttons">
                                <button class="radio-btn active green" data-group="belegFormat" data-value="perfekt" data-points="0">
                                    <div class="btn-label">1:1</div>
                                    <div class="btn-desc">1 Beleg = 1 PDF</div>
                                    <div class="btn-points">0 Pkt</div>
                                </button>
                                <button class="radio-btn" data-group="belegFormat" data-value="stapel" data-points="0.5">
                                    <div class="btn-label">Stapel</div>
                                    <div class="btn-desc">Manuell aufteilen</div>
                                    <div class="btn-points">0.5 Pkt</div>
                                </button>
                                <button class="radio-btn" data-group="belegFormat" data-value="schlecht" data-points="2" data-ko="true">
                                    <div class="btn-label">Sonstiges</div>
                                    <div class="btn-desc">Scan, Foto</div>
                                    <div class="btn-points">2 Pkt</div>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="criteria-section orange">
                        <h3>üè¢ Komplexit√§t (max 3 Pkt)</h3>
                        
                        <div class="radio-group">
                            <label class="radio-group-label">Anzahl Bankkonten & Zahlungsdienstleister (1.5 Pkt)</label>
                            <div class="radio-buttons">
                                <button class="radio-btn active green" data-group="bankkonten" data-value="eins" data-points="0">
                                    <div class="btn-label">1 Konto</div>
                                    <div class="btn-desc">Ein Bankkonto</div>
                                    <div class="btn-points">0 Pkt</div>
                                </button>
                                <button class="radio-btn" data-group="bankkonten" data-value="mehrere_mit" data-points="1">
                                    <div class="btn-label">>1 + API</div>
                                    <div class="btn-desc">Mit Schnittstelle</div>
                                    <div class="btn-points">1 Pkt</div>
                                </button>
                                <button class="radio-btn" data-group="bankkonten" data-value="mehrere_ohne" data-points="1.5">
                                    <div class="btn-label">>1 ohne API</div>
                                    <div class="btn-desc">Ohne Schnittstelle</div>
                                    <div class="btn-points">1.5 Pkt</div>
                                </button>
                            </div>
                        </div>
                        
                        <div class="radio-group">
                            <label class="radio-group-label">Anteil Auslandsgesch√§ft (1.5 Pkt)</label>
                            <div class="radio-buttons">
                                <button class="radio-btn active green" data-group="ausland" data-value="null" data-points="0">
                                    <div class="btn-label">0%</div>
                                    <div class="btn-desc">Kein Ausland</div>
                                    <div class="btn-points">0 Pkt</div>
                                </button>
                                <button class="radio-btn" data-group="ausland" data-value="unter10" data-points="1">
                                    <div class="btn-label"><10%</div>
                                    <div class="btn-desc">Wenig Ausland</div>
                                    <div class="btn-points">1 Pkt</div>
                                </button>
                                <button class="radio-btn" data-group="ausland" data-value="ueber10" data-points="1.5">
                                    <div class="btn-label">>10%</div>
                                    <div class="btn-desc">Viel Ausland</div>
                                    <div class="btn-points">1.5 Pkt</div>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="criteria-section purple">
                        <h3>üíª Digitalisierung (max 3 Pkt)</h3>
                        
                        <div class="radio-group">
                            <label class="radio-group-label">Zusendung Bankums√§tze (2 Pkt)</label>
                            <div class="radio-buttons">
                                <button class="radio-btn active green" data-group="bankumsaetze" data-value="schnittstelle" data-points="0">
                                    <div class="btn-label">API</div>
                                    <div class="btn-desc">Schnittstelle</div>
                                    <div class="btn-points">0 Pkt</div>
                                </button>
                                <button class="radio-btn" data-group="bankumsaetze" data-value="csv" data-points="0.5">
                                    <div class="btn-label">CSV</div>
                                    <div class="btn-desc">CSV-Export</div>
                                    <div class="btn-points">0.5 Pkt</div>
                                </button>
                                <button class="radio-btn" data-group="bankumsaetze" data-value="pdf" data-points="2">
                                    <div class="btn-label">PDF</div>
                                    <div class="btn-desc">PDF-Kontoauszug</div>
                                    <div class="btn-points">2 Pkt</div>
                                </button>
                            </div>
                        </div>
                        
                        <div class="radio-group">
                            <label class="radio-group-label">Zusendung Belege (1 Pkt)</label>
                            <div class="radio-buttons">
                                <button class="radio-btn active green" data-group="belege" data-value="schnittstelle" data-points="0">
                                    <div class="btn-label">API</div>
                                    <div class="btn-desc">Schnittstelle</div>
                                    <div class="btn-points">0 Pkt</div>
                                </button>
                                <button class="radio-btn" data-group="belege" data-value="dragdrop" data-points="0.5">
                                    <div class="btn-label">Upload</div>
                                    <div class="btn-desc">Drag & Drop</div>
                                    <div class="btn-points">0.5 Pkt</div>
                                </button>
                                <button class="radio-btn" data-group="belege" data-value="postemail" data-points="1">
                                    <div class="btn-label">Post/Email</div>
                                    <div class="btn-desc">Per Post/Email</div>
                                    <div class="btn-points">1 Pkt</div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="price-box">
                <div class="price-grid">
                    <div class="price-item">
                        <div class="price-label">Zehntel-Satz</div>
                        <div class="price-value" id="zehntelSatz">4/10</div>
                    </div>
                    <div class="price-item">
                        <div class="price-label">Finanzbuchhaltung</div>
                        <div class="price-value" id="fibuPreis">0.00 ‚Ç¨</div>
                    </div>
                    <div class="price-item" id="lohnPreisBox" style="display: none;">
                        <div class="price-label">Lohnbuchhaltung</div>
                        <div class="price-value" id="lohnPreis">0.00 ‚Ç¨</div>
                    </div>
                    <div class="price-item">
                        <div class="price-label">GESAMT/Monat</div>
                        <div class="price-value highlight" id="gesamtPreis">0.00 ‚Ç¨</div>
                        <div class="price-note">zzgl. 19% MwSt.</div>
                    </div>
                </div>
                
                <div class="price-footer">
                    <span>Mit MwSt. (19%):</span>
                    <span style="font-weight: bold;" id="preisInklMwst">0.00 ‚Ç¨</span>
                </div>
            </div>

            <div class="angebot-section">
                <h3>üìÑ Angebot erstellen</h3>
                
                <div class="kunde-grid">
                    <div class="input-group">
                        <label for="firmenname">Firmenname *</label>
                        <input type="text" id="firmenname" placeholder="z.B. Mustermann GmbH">
                    </div>
                    <div class="input-group">
                        <label for="ansprechpartner">Ansprechpartner</label>
                        <input type="text" id="ansprechpartner" placeholder="z.B. Herr Max Mustermann">
                    </div>
                </div>
                
                <div class="kunde-grid-wide">
                    <div class="input-group">
                        <label for="strasse">Stra√üe & Hausnummer</label>
                        <input type="text" id="strasse" placeholder="z.B. Musterstra√üe 123">
                    </div>
                    <div class="input-group">
                        <label for="plz">PLZ</label>
                        <input type="text" id="plz" placeholder="z.B. 12345">
                    </div>
                    <div class="input-group">
                        <label for="ort">Ort</label>
                        <input type="text" id="ort" placeholder="z.B. Berlin">
                    </div>
                </div>
                
                <button id="angebotErstellen" class="angebot-btn">
                    üìÑ Individuelles Angebot als PDF erstellen
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        const preisTabelle = {
            10000: [24, 30, 36, 42, 48, 54, 60],
            15000: [34.8, 43.5, 52.2, 60.9, 69.6, 78.3, 87],
            20000: [44.4, 55.5, 66.6, 77.7, 88.8, 99.9, 111],
            25000: [49.8, 62.25, 74.7, 87.15, 99.6, 112.05, 124.5],
            30000: [57.6, 72, 86.4, 100.8, 115.2, 129.6, 144],
            40000: [65.4, 81.75, 98.1, 114.45, 130.8, 147.15, 163.5],
            50000: [69.6, 87, 104.4, 121.8, 139.2, 156.6, 174],
            60000: [72, 90, 108, 126, 144, 162, 180],
            75000: [79.2, 99, 118.8, 138.6, 158.4, 178.2, 198],
            100000: [95.4, 119.25, 143.1, 166.95, 190.8, 214.65, 238.5],
            125000: [105, 131.25, 157.5, 183.75, 210, 236.25, 262.5],
            150000: [115.2, 144, 172.8, 201.6, 230.4, 259.2, 288],
            200000: [139.2, 174, 208.8, 243.6, 278.4, 313.2, 348],
            250000: [160.8, 201, 241.2, 281.4, 321.6, 361.8, 402],
            300000: [183, 228.75, 274.5, 320.25, 366, 411.75, 457.5],
            400000: [225, 281.25, 337.5, 393.75, 450, 506.25, 562.5],
            500000: [274.8, 343.5, 412.2, 480.9, 549.6, 618.3, 687],
            600000: [308.4, 385.5, 462.6, 539.7, 616.8, 693.9, 771],
            750000: [358.8, 448.5, 538.2, 627.9, 717.6, 807.3, 897],
            1000000: [442.8, 553.5, 664.2, 774.9, 885.6, 996.3, 1107],
            1500000: [610.8, 763.5, 916.2, 1068.9, 1221.6, 1374.3, 1527],
            2000000: [778.8, 973.5, 1168.2, 1362.9, 1557.6, 1752.3, 1947],
            2500000: [946.8, 1183.5, 1420.2, 1656.9, 1893.6, 2130.3, 2367]
        };

        const lohnStaffeln = [
            { bis: 5, preisMin: 14.00, preisMax: 19.50 },
            { bis: 10, preisMin: 13.50, preisMax: 18.50 },
            { bis: 20, preisMin: 13.00, preisMax: 17.50 },
            { bis: 30, preisMin: 12.50, preisMax: 16.50 },
            { bis: 40, preisMin: 12.00, preisMax: 15.50 },
            { bis: 999, preisMin: 12.00, preisMax: 15.00 }
        ];

        let state = {
            jahresumsatz: '',
            mitarbeiterAnzahl: '',
            mitLohn: true,
            zulieferung: 'ja',
            belegFormat: 'perfekt',
            bankkonten: 'eins',
            ausland: 'null',
            bankumsaetze: 'schnittstelle',
            belege: 'schnittstelle'
        };

        document.querySelectorAll('.radio-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const group = this.dataset.group;
                const value = this.dataset.value;
                
                state[group] = value;
                
                document.querySelectorAll(`[data-group="${group}"]`).forEach(b => {
                    b.classList.remove('active', 'green', 'yellow', 'red');
                });
                
                this.classList.add('active');
                const points = parseFloat(this.dataset.points);
                if (points === 0) {
                    this.classList.add('green');
                } else if (points < 1.5) {
                    this.classList.add('yellow');
                } else {
                    this.classList.add('red');
                }
                
                calculate();
            });
        });

        document.getElementById('jahresumsatz').addEventListener('input', function(e) {
            state.jahresumsatz = e.target.value;
            calculate();
        });

        document.getElementById('mitarbeiterAnzahl').addEventListener('input', function(e) {
            state.mitarbeiterAnzahl = e.target.value;
            calculate();
        });

        document.getElementById('mitLohn').addEventListener('change', function(e) {
            state.mitLohn = e.target.checked;
            document.getElementById('mitarbeiterGroup').style.display = e.target.checked ? 'block' : 'none';
            document.getElementById('lohnPreisBox').style.display = e.target.checked ? 'block' : 'none';
            calculate();
        });

        function calculate() {
            let punkte = 0;
            let hatKO = false;

            if (state.zulieferung === 'meistens') punkte += 1;
            else if (state.zulieferung === 'nein') punkte += 2;

            if (state.belegFormat === 'stapel') punkte += 0.5;
            else if (state.belegFormat === 'schlecht') {
                punkte += 2;
                hatKO = true;
            }

            if (state.bankkonten === 'mehrere_mit') punkte += 1;
            else if (state.bankkonten === 'mehrere_ohne') punkte += 1.5;

            if (state.ausland === 'unter10') punkte += 1;
            else if (state.ausland === 'ueber10') punkte += 1.5;

            if (state.bankumsaetze === 'csv') punkte += 0.5;
            else if (state.bankumsaetze === 'pdf') punkte += 2;

            if (state.belege === 'dragdrop') punkte += 0.5;
            else if (state.belege === 'postemail') punkte += 1;

            const scoreElement = document.getElementById('gesamtPunkte');
            scoreElement.textContent = `${punkte.toFixed(1)} / 10 Pkt`;
            scoreElement.className = 'score-value' + (hatKO ? ' warning' : '');

            document.getElementById('alert').className = 'alert' + (hatKO ? ' show' : '');

            document.querySelectorAll('.matching-row').forEach(row => {
                row.className = 'matching-row';
                const range = row.dataset.range.split('-').map(parseFloat);
                if (punkte > range[0] && punkte <= range[1]) {
                    row.classList.add('active');
                    if (punkte <= 1.5) row.classList.add('green');
                    else if (punkte <= 3) row.classList.add('blue');
                    else if (punkte <= 5) row.classList.add('yellow');
                    else if (punkte <= 7) row.classList.add('orange');
                    else row.classList.add('red');
                }
            });

            let satz;
            if (punkte <= 0.5) satz = 4;
            else if (punkte <= 1.5) satz = 5;
            else if (punkte <= 3) satz = 6;
            else if (punkte <= 5) satz = 7;
            else if (punkte <= 7) satz = 8;
            else if (punkte <= 8.5) satz = 9;
            else satz = 10;

            document.getElementById('zehntelSatz').textContent = `${satz}/10`;

            if (!state.jahresumsatz) {
                document.getElementById('fibuPreis').textContent = '0.00 ‚Ç¨';
                document.getElementById('lohnPreis').textContent = '0.00 ‚Ç¨';
                document.getElementById('gesamtPreis').textContent = '0.00 ‚Ç¨';
                document.getElementById('preisInklMwst').textContent = '0.00 ‚Ç¨';
                return;
            }

            const umsatz = parseFloat(state.jahresumsatz);
            const stufen = Object.keys(preisTabelle).map(Number).sort((a, b) => a - b);
            let gewaehltesStufe = stufen[stufen.length - 1];
            
            for (let stufe of stufen) {
                if (umsatz <= stufe) {
                    gewaehltesStufe = stufe;
                    break;
                }
            }

            const preisIndex = satz - 4;
            const fibu = preisTabelle[gewaehltesStufe][preisIndex] || 0;

            let lohn = 0;
            let lohnProMA = 0;
            if (state.mitLohn && state.mitarbeiterAnzahl) {
                const anzahl = parseInt(state.mitarbeiterAnzahl);
                const staffel = lohnStaffeln.find(s => anzahl <= s.bis);
                if (staffel) {
                    // Verwende Durchschnitt der Preisspanne
                    lohnProMA = (staffel.preisMin + staffel.preisMax) / 2;
                    lohn = anzahl * lohnProMA;
                }
            }

            const gesamt = fibu + lohn;
            const mitMwst = gesamt * 1.19;

            document.getElementById('fibuPreis').textContent = `${fibu.toFixed(2)} ‚Ç¨`;
            document.getElementById('lohnPreis').textContent = `${lohn.toFixed(2)} ‚Ç¨`;
            document.getElementById('gesamtPreis').textContent = `${gesamt.toFixed(2)} ‚Ç¨`;
            document.getElementById('preisInklMwst').textContent = `${mitMwst.toFixed(2)} ‚Ç¨`;
        }

        calculate();

        // PDF Export
        document.getElementById('angebotErstellen').addEventListener('click', function() {
            const firmenname = document.getElementById('firmenname').value;
            
            if (!firmenname) {
                alert('‚ö†Ô∏è Bitte geben Sie mindestens einen Firmennamen ein.');
                return;
            }
            
            if (!state.jahresumsatz) {
                alert('‚ö†Ô∏è Bitte geben Sie einen Jahresumsatz ein.');
                return;
            }

            const ansprechpartner = document.getElementById('ansprechpartner').value;
            const strasse = document.getElementById('strasse').value;
            const plz = document.getElementById('plz').value;
            const ort = document.getElementById('ort').value;
            
            let punkte = 0;
            if (state.zulieferung === 'meistens') punkte += 1;
            else if (state.zulieferung === 'nein') punkte += 2;
            if (state.belegFormat === 'stapel') punkte += 0.5;
            else if (state.belegFormat === 'schlecht') punkte += 2;
            if (state.bankkonten === 'mehrere_mit') punkte += 1;
            else if (state.bankkonten === 'mehrere_ohne') punkte += 1.5;
            if (state.ausland === 'unter10') punkte += 1;
            else if (state.ausland === 'ueber10') punkte += 1.5;
            if (state.bankumsaetze === 'csv') punkte += 0.5;
            else if (state.bankumsaetze === 'pdf') punkte += 2;
            if (state.belege === 'dragdrop') punkte += 0.5;
            else if (state.belege === 'postemail') punkte += 1;

            let satz;
            if (punkte <= 0.5) satz = 4;
            else if (punkte <= 1.5) satz = 5;
            else if (punkte <= 3) satz = 6;
            else if (punkte <= 5) satz = 7;
            else if (punkte <= 7) satz = 8;
            else if (punkte <= 8.5) satz = 9;
            else satz = 10;

            const umsatz = parseFloat(state.jahresumsatz);
            const stufen = Object.keys(preisTabelle).map(Number).sort((a, b) => a - b);
            let gewaehltesStufe = stufen[stufen.length - 1];
            for (let stufe of stufen) {
                if (umsatz <= stufe) {
                    gewaehltesStufe = stufe;
                    break;
                }
            }
            const preisIndex = satz - 4;
            const fibu = preisTabelle[gewaehltesStufe][preisIndex] || 0;

            let lohn = 0;
            if (state.mitLohn && state.mitarbeiterAnzahl) {
                const anzahl = parseInt(state.mitarbeiterAnzahl);
                const staffel = lohnStaffeln.find(s => anzahl <= s.bis);
                lohn = staffel ? anzahl * staffel.preis : 0;
            }

            const gesamt = fibu + lohn;
            const mitMwst = gesamt * 1.19;
            
            const heute = new Date();
            const datumStr = heute.toLocaleDateString('de-DE', { year: 'numeric', month: 'long', day: 'numeric' });
            const angebotsnr = 'ANG-' + heute.getFullYear() + (heute.getMonth() + 1).toString().padStart(2, '0') + heute.getDate().toString().padStart(2, '0') + '-' + Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            
            // Erstelle professionelles HTML-Angebot
            const angebotHTML = `<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Angebot - ${firmenname}</title>
    <style>
        @media print {
            body { margin: 0; }
            @page { margin: 1.5cm; }
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 210mm;
            margin: 0 auto;
            padding: 20mm;
            background: white;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #1e3a8a;
        }
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .company-info {
            text-align: right;
            font-size: 0.9em;
            color: #666;
        }
        .company-info strong {
            color: #1e3a8a;
            font-size: 1.2em;
            display: block;
            margin-bottom: 5px;
        }
        .recipient {
            margin: 30px 0;
        }
        .recipient strong {
            display: block;
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        .meta-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 30px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .meta-info div {
            font-size: 0.9em;
        }
        .meta-info strong {
            color: #1e3a8a;
        }
        h1 {
            color: #1e3a8a;
            font-size: 1.8em;
            margin: 30px 0 20px 0;
        }
        .intro {
            margin: 20px 0;
            line-height: 1.8;
        }
        .bewertung {
            background: #eff6ff;
            padding: 20px;
            border-radius: 8px;
            margin: 30px 0;
            border-left: 4px solid #1e3a8a;
        }
        .bewertung h2 {
            color: #1e3a8a;
            font-size: 1.3em;
            margin-bottom: 15px;
        }
        .kriterien-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        .kriterien-header {
            font-weight: bold;
            padding: 10px;
            background: #1e3a8a;
            color: white;
            border-radius: 5px 5px 0 0;
        }
        .kriterien-row {
            padding: 10px;
            background: white;
            border-bottom: 1px solid #e5e7eb;
        }
        .kriterien-row:last-child {
            border-bottom: none;
            border-radius: 0 0 5px 5px;
        }
        .zehntel-box {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            text-align: center;
            border: 2px solid #1e3a8a;
        }
        .zehntel-box .label {
            font-size: 0.9em;
            color: #666;
        }
        .zehntel-box .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #1e3a8a;
        }
        .preise {
            margin: 30px 0;
        }
        .preise h2 {
            color: #1e3a8a;
            font-size: 1.3em;
            margin-bottom: 20px;
        }
        .preis-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .preis-table th {
            background: #1e3a8a;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        .preis-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        .preis-table tr:last-child td {
            border-bottom: none;
        }
        .preis-table .total-row {
            background: #f8f9fa;
            font-weight: bold;
            font-size: 1.1em;
        }
        .preis-table .total-row td {
            padding: 15px 12px;
            border-top: 2px solid #1e3a8a;
        }
        .highlight-preis {
            color: #1e3a8a;
            font-size: 1.2em;
        }
        .hinweis {
            background: #fef3c7;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #f59e0b;
            margin: 20px 0;
            font-size: 0.95em;
        }
        .footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
            font-size: 0.85em;
            color: #666;
        }
        .footer strong {
            display: block;
            margin-bottom: 10px;
            color: #1e3a8a;
        }
        .unterschrift {
            margin-top: 60px;
        }
        .unterschrift-line {
            border-top: 1px solid #333;
            width: 250px;
            margin-top: 50px;
        }
        .print-button {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            background: #1e3a8a;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .print-button:hover {
            background: #1e40af;
        }
        @media print {
            .print-button { display: none; }
        }
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
        .status-green { background: #d1fae5; color: #065f46; }
        .status-yellow { background: #fef3c7; color: #92400e; }
        .status-red { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>
    <button class="print-button" onclick="window.print()">üñ®Ô∏è Drucken / Als PDF speichern</button>

    <div class="header">
        <div class="logo-section">
            <svg width="60" height="60" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="100" height="100" rx="15" fill="#1e3a8a"/>
                <circle cx="35" cy="35" r="20" fill="white"/>
                <circle cx="55" cy="55" r="15" fill="#fb923c"/>
            </svg>
            <div>
                <strong style="font-size: 1.5em; color: #1e3a8a;">Bilancor</strong>
                <div style="color: #666;">Buchhaltungsb√ºro f√ºr Selbst√§ndige & Unternehmer</div>
            </div>
        </div>
        <div class="company-info">
            <strong>Bilancor</strong>
            Richard-Ermisch-Str. 7<br>
            10247 Berlin<br>
            Tel: +49 15565509949<br>
            anfrage@bilancor.de
        </div>
    </div>

    <div class="recipient">
        <strong>${firmenname}</strong>
        ${ansprechpartner ? ansprechpartner + '<br>' : ''}
        ${strasse ? strasse + '<br>' : ''}
        ${plz || ort ? (plz + ' ' + ort).trim() : ''}
    </div>

    <div class="meta-info">
        <div><strong>Angebotsnummer:</strong> ${angebotsnr}</div>
        <div><strong>Datum:</strong> ${datumStr}</div>
        <div><strong>G√ºltig bis:</strong> ${new Date(heute.getTime() + 30*24*60*60*1000).toLocaleDateString('de-DE')}</div>
        <div><strong>Ihr Jahresumsatz:</strong> ${umsatz.toLocaleString('de-DE')} ‚Ç¨</div>
    </div>

    <h1>Individuelles Angebot f√ºr Buchhaltungsdienstleistungen</h1>

    <div class="intro">
        <p>Sehr geehrte Damen und Herren${ansprechpartner ? ', sehr geehrte/r ' + ansprechpartner : ''},</p>
        <p>vielen Dank f√ºr Ihr Interesse an unseren Dienstleistungen. Basierend auf den von Ihnen bereitgestellten Informationen zu Ihrer Unternehmensstruktur erstellen wir Ihnen gerne folgendes individuelles Angebot:</p>
    </div>

    <div class="bewertung">
        <h2>üìä Ihre Unternehmensbewertung</h2>
        <p>Wir haben Ihr Unternehmen anhand verschiedener Kriterien bewertet, um ein faires und transparentes Preismodell zu erstellen:</p>
        
        <div class="kriterien-grid">
            <div class="kriterien-header">Kriterium</div>
            <div class="kriterien-header">Status</div>
            <div class="kriterien-header">Punkte</div>
            
            <div class="kriterien-row"><strong>Zulieferung vor Stichtag</strong></div>
            <div class="kriterien-row">${state.zulieferung === 'ja' ? '<span class="status-badge status-green">Immer rechtzeitig</span>' : state.zulieferung === 'meistens' ? '<span class="status-badge status-yellow">Meistens</span>' : '<span class="status-badge status-red">Oft versp√§tet</span>'}</div>
            <div class="kriterien-row">${state.zulieferung === 'ja' ? '0' : state.zulieferung === 'meistens' ? '1' : '2'} Pkt</div>
            
            <div class="kriterien-row"><strong>Belegformat</strong></div>
            <div class="kriterien-row">${state.belegFormat === 'perfekt' ? '<span class="status-badge status-green">1:1 PDF</span>' : state.belegFormat === 'stapel' ? '<span class="status-badge status-yellow">Stapel</span>' : '<span class="status-badge status-red">Scan/Foto</span>'}</div>
            <div class="kriterien-row">${state.belegFormat === 'perfekt' ? '0' : state.belegFormat === 'stapel' ? '0.5' : '2'} Pkt</div>
            
            <div class="kriterien-row"><strong>Bankkonten</strong></div>
            <div class="kriterien-row">${state.bankkonten === 'eins' ? '<span class="status-badge status-green">1 Konto</span>' : state.bankkonten === 'mehrere_mit' ? '<span class="status-badge status-yellow">>1 mit API</span>' : '<span class="status-badge status-red">>1 ohne API</span>'}</div>
            <div class="kriterien-row">${state.bankkonten === 'eins' ? '0' : state.bankkonten === 'mehrere_mit' ? '1' : '1.5'} Pkt</div>
            
            <div class="kriterien-row"><strong>Auslandsgesch√§ft</strong></div>
            <div class="kriterien-row">${state.ausland === 'null' ? '<span class="status-badge status-green">0%</span>' : state.ausland === 'unter10' ? '<span class="status-badge status-yellow"><10%</span>' : '<span class="status-badge status-red">>10%</span>'}</div>
            <div class="kriterien-row">${state.ausland === 'null' ? '0' : state.ausland === 'unter10' ? '1' : '1.5'} Pkt</div>
            
            <div class="kriterien-row"><strong>Bankums√§tze</strong></div>
            <div class="kriterien-row">${state.bankumsaetze === 'schnittstelle' ? '<span class="status-badge status-green">API</span>' : state.bankumsaetze === 'csv' ? '<span class="status-badge status-yellow">CSV</span>' : '<span class="status-badge status-red">PDF</span>'}</div>
            <div class="kriterien-row">${state.bankumsaetze === 'schnittstelle' ? '0' : state.bankumsaetze === 'csv' ? '0.5' : '2'} Pkt</div>
            
            <div class="kriterien-row"><strong>Belegzusendung</strong></div>
            <div class="kriterien-row">${state.belege === 'schnittstelle' ? '<span class="status-badge status-green">API</span>' : state.belege === 'dragdrop' ? '<span class="status-badge status-yellow">Upload</span>' : '<span class="status-badge status-red">Post/Email</span>'}</div>
            <div class="kriterien-row">${state.belege === 'schnittstelle' ? '0' : state.belege === 'dragdrop' ? '0.5' : '1'} Pkt</div>
        </div>

        <div class="zehntel-box">
            <div class="label">Ihr individueller Zehntel-Satz</div>
            <div class="value">${satz}/10</div>
            <div style="margin-top: 10px; color: #666;">Gesamtpunkte: ${punkte.toFixed(1)} von 10 Punkten</div>
        </div>
    </div>

    <div class="preise">
        <h2>üí∞ Ihre monatlichen Kosten</h2>
        
        <table class="preis-table">
            <thead>
                <tr>
                    <th>Leistung</th>
                    <th>Details</th>
                    <th style="text-align: right;">Preis (netto)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Finanzbuchhaltung</strong></td>
                    <td>
                        Vollumf√§ngliche Buchhaltung f√ºr Jahresumsatz ${umsatz.toLocaleString('de-DE')} ‚Ç¨<br>
                        <small style="color: #666;">Inkl. Umsatzsteuervoranmeldung, BWA, Kontenabstimmung</small>
                    </td>
                    <td style="text-align: right; font-weight: 600;">${fibu.toFixed(2)} ‚Ç¨</td>
                </tr>
                ${state.mitLohn && state.mitarbeiterAnzahl ? `
                <tr>
                    <td><strong>Lohnbuchhaltung</strong></td>
                    <td>
                        ${state.mitarbeiterAnzahl} Mitarbeiter<br>
                        <small style="color: #666;">Inkl. Lohnabrechnungen, Meldungen, Bescheinigungen</small>
                    </td>
                    <td style="text-align: right; font-weight: 600;">${lohn.toFixed(2)} ‚Ç¨</td>
                </tr>
                ` : ''}
                <tr class="total-row">
                    <td colspan="2"><strong>Gesamtsumme (netto)</strong></td>
                    <td style="text-align: right;" class="highlight-preis">${gesamt.toFixed(2)} ‚Ç¨</td>
                </tr>
                <tr>
                    <td colspan="2">zzgl. 19% MwSt.</td>
                    <td style="text-align: right;">${(gesamt * 0.19).toFixed(2)} ‚Ç¨</td>
                </tr>
                <tr class="total-row">
                    <td colspan="2"><strong>Gesamtsumme (brutto) pro Monat</strong></td>
                    <td style="text-align: right;" class="highlight-preis">${mitMwst.toFixed(2)} ‚Ç¨</td>
                </tr>
            </tbody>
        </table>

        <div class="hinweis">
            <strong>üìÖ Jahreskosten:</strong> Bei 12 Monaten ergeben sich Gesamtkosten von <strong>${(mitMwst * 12).toFixed(2)} ‚Ç¨ (brutto)</strong> bzw. <strong>${(gesamt * 12).toFixed(2)} ‚Ç¨ (netto)</strong> pro Jahr.
        </div>
    </div>

    <div class="footer">
        <strong>Leistungsumfang:</strong>
        <ul style="margin: 10px 0; padding-left: 20px;">
            <li>Erfassung aller Gesch√§ftsvorf√§lle in moderner Buchhaltungssoftware</li>
            <li>Monatliche Erstellung von BWA (Betriebswirtschaftliche Auswertung)</li>
            <li>Umsatzsteuer-Voranmeldungen an das Finanzamt</li>
            <li>Jahresabschlussvorbereitung f√ºr Ihren Steuerberater</li>
            ${state.mitLohn && state.mitarbeiterAnzahl ? '<li>Vollst√§ndige Lohnbuchhaltung inkl. aller Meldungen</li>' : ''}
            <li>Pers√∂nlicher Ansprechpartner f√ºr alle Fragen</li>
            <li>Digitale Dokumentenverwaltung</li>
        </ul>

        <strong>Konditionen:</strong>
        <ul style="margin: 10px 0; padding-left: 20px;">
            <li>Mindestvertragslaufzeit: 12 Monate</li>
            <li>K√ºndigungsfrist: 3 Monate zum Monatsende</li>
            <li>Zahlung: monatlich per SEPA-Lastschrift</li>
            <li>Angebot g√ºltig f√ºr 30 Tage ab Ausstellungsdatum</li>
        </ul>

        <p style="margin-top: 20px;">Bei Fragen oder f√ºr ein pers√∂nliches Gespr√§ch stehen wir Ihnen gerne zur Verf√ºgung. Wir freuen uns auf eine erfolgreiche Zusammenarbeit!</p>

        <p style="margin-top: 30px;">Mit freundlichen Gr√º√üen</p>
    </div>

    <div class="unterschrift">
        <div class="unterschrift-line"></div>
        <div style="margin-top: 5px;"><strong>Bilancor</strong></div>
        <div style="color: #666; font-size: 0.9em;">Inhaberschaft</div>
    </div>
</body>
</html>`;

            // √ñffne Angebot in neuem Fenster
            const printWindow = window.open('', '_blank', 'width=900,height=1200');
            
            if (!printWindow || printWindow.closed || typeof printWindow.closed === 'undefined') {
                alert('‚ö†Ô∏è Popup-Blocker aktiv!\n\nBitte erlauben Sie Popups f√ºr diese Seite und versuchen Sie es erneut.');
            } else {
                printWindow.document.write(angebotHTML);
                printWindow.document.close();
            }
        });
    </script>
</body>
</html>
